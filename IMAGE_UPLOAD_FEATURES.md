# 图片上传功能说明

## 新增功能

### 1. 图片上传支持
- 支持多种常见图片格式：PNG, JPG, JPEG, GIF, WebP, BMP, TIFF
- 支持拖拽上传和点击上传
- 实时图片预览
- 支持多张图片同时上传

### 2. 数据库结构更新
- 新增 `prompt_images` 表存储多张图片
- 支持设置主图（首图）
- 图片路径存储在 `image_path` 字段
- 通过 `is_primary` 字段标识主图

### 3. 前端界面更新

#### 添加/编辑表单
- 新增图片上传区域，支持拖拽和点击上传
- 实时预览上传的图片
- 可以删除已上传的图片
- 保留原有的URL输入作为备选方案

#### 详情页面
- 支持多张图片左右滑动查看
- 图片指示器显示当前位置
- 左右箭头按钮控制切换
- 仅显示首图在列表页面

#### 流式浏览页面
- 每个项目卡片支持多图展示
- 左右滑动按钮和指示器
- 保持原有的滚动浏览体验

### 4. API 端点

#### 新增端点
- `POST /api/upload` - 上传图片文件
- `POST /api/prompts/<id>/images` - 为指定prompt添加图片
- `GET /api/prompts/<id>/images` - 获取指定prompt的所有图片

#### 更新端点
- `GET /api/prompts` - 返回包含图片信息的prompt列表
- `GET /api/prompts/<id>` - 返回包含图片信息的单个prompt
- `POST /api/prompts` - 支持创建时添加图片
- `PUT /api/prompts/<id>` - 支持更新图片

### 5. 使用说明

#### 添加新Prompt
1. 点击"添加Prompt"按钮
2. 填写基本信息
3. 在图片上传区域拖拽或点击上传图片
4. 预览上传的图片，可以删除不需要的图片
5. 保存Prompt

#### 查看多图
1. 在列表页面点击任意Prompt卡片
2. 在详情页面使用左右箭头或指示器切换图片
3. 在流式浏览页面也可以左右滑动查看多图

#### 编辑Prompt
1. 在详情页面点击"编辑"按钮
2. 可以添加、删除或重新排序图片
3. 保存更改

### 6. 技术实现

#### 后端
- 使用Flask处理文件上传
- 支持多文件上传
- 生成唯一文件名避免冲突
- 文件类型验证

#### 前端
- 原生JavaScript实现拖拽上传
- CSS Grid布局展示图片预览
- 图片轮播组件
- 响应式设计

#### 数据库
- SQLite数据库
- 外键约束确保数据一致性
- 级联删除避免孤立数据

### 7. 文件结构
```
prompt-flow/
├── app.py                 # 后端API服务器
├── static/
│   ├── images/           # 上传的图片存储目录
│   ├── app.js            # 主页面JavaScript
│   ├── streaming.js      # 流式浏览JavaScript
│   ├── style.css         # 主页面样式
│   └── streaming.css     # 流式浏览样式
├── index.html            # 主页面
├── streaming.html        # 流式浏览页面
└── prompts.db           # SQLite数据库
```

### 8. 图片显示特性

#### 列表页面
- 使用固定尺寸显示框（400x300px）
- 仅显示首图作为封面
- 使用 `object-fit: cover` 保持固定比例

#### 详情页面
- 图片自适应显示，保持原始比例
- 使用 `object-fit: contain` 避免裁剪
- 支持左右滑动查看所有图片
- 图片指示器显示当前位置

#### 流式浏览页面
- 卡片模式：固定比例裁剪显示
- 详情展开：自适应比例显示
- 支持多图滑动查看

### 9. URL处理
- 每张图片都有独立的完整URL
- 自动转换相对路径为绝对URL
- 支持外部URL和本地文件混合使用

### 10. 注意事项
- 确保 `static/images` 目录存在且有写入权限
- 上传的图片会自动重命名以避免冲突
- 建议图片大小不超过10MB
- 支持的图片格式在 `ALLOWED_EXTENSIONS` 中定义
- 详情页图片会保持原始比例，不会裁剪
